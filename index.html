<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AMS Request System – Pharmacy</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin:0;
      height:100vh;
      overflow:hidden;
    }
    .sidebar { width:220px; box-sizing:border-box; background:#f7f7f7; padding:20px; box-shadow:2px 0 4px rgba(0,0,0,0.1); }
    .sidebar h2 { font-size:18px; margin-bottom:20px; }
    .sidebar button { width:100%; margin-bottom:10px; padding:10px; border:none; background:#009a3e; color:white; cursor:pointer; border-radius:6px; }
    .main { flex:1; padding:24px; overflow-y:auto; }
    .section { display:none; }
    .active { display:block; }
    .card { background:white; padding:16px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); margin-bottom:16px; }
    .btn { padding:8px 12px; border:none; border-radius:6px; cursor:pointer; margin-right:8px; }
    .approve { background:#009a3e; color:white; }
    .disapprove { background:#dc2626; color:white; }
    .delete { background:#6b7280; color:white; }
    table { width:100%; border-collapse:collapse; margin-top:16px; }
    table th, table td { border:1px solid #ddd; padding:8px; }
    table th { background:#009a3e; color:white; }
  </style>
</head>
<body>

  <!-- HEADER (similar to antimicrobial request form) -->
  <header style="width:100%; display:flex; align-items:center; gap:1rem; background:#009a3e; color:#fff; padding:0.75rem 1rem; position:fixed; top:0; left:0; z-index:10; border-radius:0 0 0.75rem 0.75rem;">
    <img src="https://maxterrenal-hash.github.io/justculture/osmak-logo.png" alt="OsMak Logo" style="height:48px; width:auto;" />
    <div style="display:flex; flex-direction:column; line-height:1.2;">
      <span style="font-size:1.1rem; letter-spacing:0.04em; text-transform:uppercase; font-weight:700;">Ospital ng Makati</span>
      <span style="font-size:0.8rem; opacity:0.9;">AMS Request System – Pharmacy Module</span>
    </div>
  </header>

  <!-- Spacer so content does not hide under header -->
  <div style="height:40px; width:100%;"></div>
  <div class="sidebar" style="position:absolute; top:80px; left:0; height:calc(100vh - 80px); width:220px; overflow-y:auto;">
    
    <button onclick="showSection('pending')">Pending</button>
    <button onclick="showSection('ids')">For IDS Approval</button>
    <button onclick="showSection('approved')">Approved</button>
    <button onclick="showSection('disapproved')">Disapproved</button>
    <button onclick="showSection('deleted')">Deleted</button>
    <button onclick="showSection('analysis')">Data Analysis</button>
  </div>

  <div class="main" style="margin-left:220px; margin-top:20px; height:calc(100vh - 80px); overflow-y:auto; padding:24px;">

    <!-- Pending Section -->
    <div id="pending" class="section active">
      <h2>Pending Requests</h2>
      <label>Date:</label> <input type="date" id="pendingDate">
      <button class="btn approve" onclick="loadPending()">Load Requests</button>
      <div id="pendingList"></div>
    </div>

    <!-- IDS Section -->
    <div id="ids" class="section">
      <h2>For IDS Approval</h2>
      <label>Date:</label> <input type="date" id="idsDate">
      <button class="btn approve" onclick="loadIDS()">Filter</button>
      <div id="idsList"></div>
    </div>

    <!-- Approved Table -->
    <div id="approved" class="section">
      <h2>Approved</h2>
      <label>Date:</label> <input type="date" id="approvedDate">
      <button class="btn approve" onclick="loadApproved()">Filter</button>
      <table id="approvedTable">
        <thead><tr><th>Patient</th><th>Drug</th><th>Dose</th><th>Resident</th><th>Date</th><th>Delete</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Disapproved Table -->
    <div id="disapproved" class="section">
      <h2>Disapproved</h2>
      <label>Date:</label> <input type="date" id="disDate">
      <button class="btn approve" onclick="loadDisapproved()">Filter</button>
      <table id="disTable">
        <thead><tr><th>Patient</th><th>Drug</th><th>Reason</th><th>Date</th><th>Delete</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Deleted Table -->
    <div id="deleted" class="section">
      <h2>Deleted Records</h2>
      <label>Date:</label> <input type="date" id="delDate">
      <button class="btn approve" onclick="loadDeleted()">Filter</button>
      <table id="delTable">
        <thead><tr><th>Patient</th><th>Drug</th><th>Date</th><th>Deleted On</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Analysis -->
    <div id="analysis" class="section">
      <h2>Data Analysis</h2>
      <label>From:</label> <input type="date" id="fromDate">
      <label>To:</label> <input type="date" id="toDate">
      <button class="btn approve" onclick="runAnalysis()">Go</button>
      <div id="analysisPanel"></div>
    </div>

  </div>

<script>
// === CONFIG: Replace with your deployed Apps Script Web App URL ===
const API_URL = "https://script.google.com/macros/s/AKfycbza855egXWFLXFiJo_m6VIz-kcEIySdXsf1ilzuPbJeHdzghQoSWU4ri2uJ29zdx7JCkQ/exec";

// Helper: Fetch wrapper
async function api(action, payload={}){
  const res = await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ action, payload })
  });
  return res.json();
}

function showSection(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function loadPending(){
  const date = document.getElementById('pendingDate').value;
  const list = document.getElementById('pendingList');
  if(!date){ list.innerHTML = '<p>Please select a date.</p>'; return; }
  list.innerHTML = '<p>Loading...</p>';

  api('getPending', { date }).then(data => {
    if(!data.ok){ list.innerHTML = '<p>Error loading data.</p>'; return; }
    const rows = data.rows || [];
    if(rows.length === 0){ list.innerHTML = '<p>No pending requests for this date.</p>'; return; }

    list.innerHTML = '';
    rows.forEach(row => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <strong>${row['Patient Name']}</strong><br>
        Drug: ${row['Drug']}<br>
        Dose: ${row['Dose']}<br>
        Resident: ${row['Resident Name']}<br>
        <div style="margin-top:10px;">
          <button class="btn approve" onclick="approveRow('${row["Timestamp"]}')">Approve</button>
          <button class="btn disapprove" onclick="disapproveRow('${row["Timestamp"]}')">Disapprove</button>
          <button class="btn delete" onclick="deleteRow('${row["Timestamp"]}')">Delete</button>
        </div>
      `;
      list.appendChild(card);
    });
  });
}

function approveRow(id){ api('approveRow',{id}).then(()=>loadPending()); }
function disapproveRow(id){ api('disapproveRow',{id}).then(()=>loadPending()); }
function deleteRow(id){ api('deleteRow',{id}).then(()=>loadPending()); }
function loadIDS(){ document.getElementById('idsList').innerHTML = '<div class="card">Sample IDS Card</div>'; }
function loadApproved(){ }
function loadDisapproved(){}
function loadDeleted(){}
function runAnalysis(){}
</script>

</body>
</html>
